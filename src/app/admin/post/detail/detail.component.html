<section>
	<div class="container-fluid">
		<form [formGroup]="form" (submit)="save()" novalidate class="forms form-horizontal">
			<div class="card">
				<div class="card-close">
					<span class="action" (click)="resetForm()"> <i class="fas fa-sync"></i> </span>
				</div>
				<div class="card-header">
					{{ title || 'Post' }}
				</div>
				<div class="card-body">
					<div class="form-group row">
						<label class="offset-sm-1 col-sm-2 form-control-label">
							Category
						</label>
						<div class="col-sm-8 select">
							<select formControlName="category_id"
							        class="form-control" [class.is-invalid]="hasError('category_id')">
								<option [value]="null" disabled> Please select a category</option>
								<option *ngFor="let cat of categories" [value]="cat.id">
									{{ cat.translations[ 0 ].name }}
								</option>
							</select>
							
							<div class="is-invalid help-block text-danger" *ngIf="hasError('category_id')">
								<small *ngIf="form.get('category_id').hasError('required')"> this is required </small>
								<small *ngFor="let err of getErrors('category_id')"> {{ err }} </small>
							</div>
						</div>
					</div>
					<div class="line"></div>

					<div class="form-group row mb-5">
						<label class="offset-sm-1 col-sm-2 form-control-label">
							Tags
						</label>
						<div class="col-sm-8">
							<tags-input class="form-control"></tags-input>
						</div>
					</div>

					<ngb-tabset justify="justified" type="pills" formArrayName="translations">
						<ngb-tab *ngFor="let t of getTranslations().controls; let idx = index;"
						         [formArrayName]="idx">
							<ng-template ngbTabTitle>
								{{ t.get("lang_id").value | atIndexOf:languages:"id":"name" }}
							</ng-template>
							
							<ng-template ngbTabContent>
								<div class="pt-4 px-3">
									<div class="form-group row">
										<label class="offset-sm-1 col-sm-2 form-control-label">
											Cover Picture
										</label>
										<div class="col-sm-8">
											<app-file-input formControlName="cover"></app-file-input>
										</div>
									</div>
									<div class="line"></div>
									
									<div class="form-group row">
										<label class="offset-sm-1 col-sm-2 form-control-label">
											Cover Alt
										</label>
										<div class="col-sm-8">
											<input type="text" formControlName="cover_alt" class="form-control">
											<div class="help-block text-xsmall">
												This text is usually displayed when the image can't be properly loaded or
												when the user is hovering the cover picture.
											</div>
										</div>
									</div>
									<div class="line"></div>
									
									<div class="form-group row">
										<label class="offset-sm-1 col-sm-2 form-control-label">
											Title
										</label>
										<div class="col-sm-8">
											<input type="text" formControlName="title" class="form-control"
											       (change)="setSlug(idx)">
										</div>
									</div>
									<div class="line"></div>
									
									<div class="form-group row">
										<label class="offset-sm-1 col-sm-2 form-control-label">
											Slug
										</label>
										<div class="col-sm-8">
											<input type="text" formControlName="slug" class="form-control">
										</div>
									</div>
									<div class="line"></div>
									
									<div class="form-group row">
										<label class="offset-sm-1 col-sm-2 form-control-label">
											Content
										</label>
										<div class="col-sm-8">
											<div [froalaEditor]="editorOptions" formControlName="content"></div>
										</div>
									</div>
								</div>
							</ng-template>
						</ngb-tab>
					</ngb-tabset>
				</div>
				<div class="card-footer">
					<button type="submit" class="btn btn-primary" [ladda]="loading" data-style="zoom-in">
						Save
					</button>
					<button type="button" class="btn btn-outline-secondary">
						Cancel
					</button>
				</div>
			</div>
		</form>
	</div>
</section>